<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boleta de Venta - Hotel Casanova</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        .ticket {
            background-color: #fffdf0; /* Color papel */
            border-top: 10px solid #ffc107; /* Borde amarillo */
            font-family: 'Courier New', Courier, monospace; /* Fuente tipo ticket */
        }
    </style>
</head>
<body class="bg-dark d-flex align-items-center justify-content-center" style="min-height: 100vh;">

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-5">
                
                <!-- TICKET / BOLETA -->
                <div class="card ticket shadow-lg rounded-0 border-0 p-4" id="boletaContent">
                    
                    <div class="text-center mb-4">
                        <h2 class="fw-bold text-uppercase mb-0">üè® Hotel Casanova</h2>
                        <p class="small text-muted">RUC: 20556677889</p>
                        <h4 class="mt-3 border-bottom pb-2 border-dark">BOLETA DE VENTA</h4>
                    </div>

                    <div class="mb-3">
                        <div class="d-flex justify-content-between">
                            <strong>Reserva N¬∞:</strong>
                            <span id="reservaId">...</span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <strong>Cliente:</strong>
                            <span id="reservaCliente">...</span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <strong>Fecha Emisi√≥n:</strong>
                            <span id="fechaHoy">...</span>
                        </div>
                    </div>

                    <table class="table table-sm table-borderless border-top border-bottom border-dark">
                        <thead>
                            <tr>
                                <th>Descripci√≥n</th>
                                <th class="text-end">Importe</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <span id="reservaHabitacion" class="fw-bold">...</span><br>
                                    <small class="text-muted">
                                        Entrada: <span id="fechaIn"></span><br>
                                        Salida: <span id="fechaOut"></span>
                                    </small>
                                </td>
                                <td class="text-end align-middle fs-5" id="reservaTotalDetalle">...</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="d-flex justify-content-between align-items-center mt-3">
                        <h4 class="fw-bold">TOTAL A PAGAR</h4>
                        <h2 class="fw-bold text-success">$<span id="reservaTotal">0.00</span></h2>
                    </div>

                    <div class="text-center mt-4 d-print-none">
                        <button onclick="window.print()" class="btn btn-outline-dark w-100 mb-2">
                            <i class="bi bi-printer"></i> Imprimir Comprobante
                        </button>
                        <a href="/perfil" class="btn btn-dark w-100 mb-2">Ir a Mis Reservas</a>
                        <a href="/" class="btn btn-link text-muted">Volver al Inicio</a>
                    </div>
                </div>

                <!-- Mensaje de error si falla la carga -->
                <div id="errorMsg" class="alert alert-danger mt-3 text-center" style="display:none;">
                    No se encontraron datos de la reserva.
                </div>

            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // 1. Obtener el ID de la reserva desde la URL (ej: /boleta?id=5)
            const params = new URLSearchParams(window.location.search);
            const idReserva = params.get('id');

            if (!idReserva) {
                window.location.href = '/perfil';
                return;
            }

            // 2. Pedir los datos de ESA reserva al servidor
            fetch(`/api/reserva_detalle/${idReserva}`)
                .then(r => r.ok ? r.json() : null)
                .then(data => {
                    if (data) {
                        // Llenar la boleta con los datos reales
                        document.getElementById('reservaId').innerText = String(data.id).padStart(6, '0');
                        document.getElementById('reservaCliente').innerText = data.nombre_completo;
                        document.getElementById('fechaHoy').innerText = new Date().toLocaleDateString();
                        
                        document.getElementById('reservaHabitacion').innerText = `Habitaci√≥n ${data.tipo.toUpperCase()}`;
                        
                        // Ajuste de zona horaria para fechas
                        const fIn = new Date(data.fecha_checkin);
                        fIn.setMinutes(fIn.getMinutes() + fIn.getTimezoneOffset());
                        
                        const fOut = new Date(data.fecha_checkout);
                        fOut.setMinutes(fOut.getMinutes() + fOut.getTimezoneOffset());

                        document.getElementById('fechaIn').innerText = fIn.toLocaleDateString();
                        document.getElementById('fechaOut').innerText = fOut.toLocaleDateString();

                        document.getElementById('reservaTotal').innerText = data.total_pago;
                        document.getElementById('reservaTotalDetalle').innerText = '$' + data.total_pago;
                    } else {
                        document.getElementById('boletaContent').style.display = 'none';
                        document.getElementById('errorMsg').style.display = 'block';
                    }
                });
        });
    </script>
</body>
</html>