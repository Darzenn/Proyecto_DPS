<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Habitaciones – Administrador</title>

    <!-- CSS (subimos un nivel) -->
    <link rel="stylesheet" href="../css/styles.css">
</head>

<body>

    <header>
        <div class="nav-container">
            <div class="logo">
                <span>CASANOVA</span> HOTEL
            </div>

            <nav>
                <ul>
                    <li><a href="../index.html">Inicio</a></li>
                    <li><a href="panel.html">Panel admin</a></li>
                    <li><a href="login.html">Cerrar sesión</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <section class="section">
        <h1 class="section-titulo">Gestión de Habitaciones</h1>
        <p class="section-subtitulo">
            Módulo interno para que el administrador registre y actualice las habitaciones del Hotel Casanova.
            Esto se relaciona con la tabla <code>habitaciones</code> de la base de datos.
        </p>
    </section>

    <section class="section">

        <div class="reserva-layout">
            <!-- Formulario -->
            <div class="card">
                <h3>Registrar / Actualizar habitación</h3>

                <form id="form-habitacion-admin">
                    <div class="form-group">
                        <label for="habNumero">N° de habitación *</label>
                        <input type="text" id="habNumero" placeholder="Ejemplo: J101" required>
                    </div>

                    <div class="form-group">
                        <label for="habTipo">Tipo de habitación *</label>
                        <select id="habTipo" required>
                            <option value="">Selecciona una opción</option>
                            <option value="Junior Suite">Junior Suite</option>
                            <option value="Ejecutiva">Ejecutiva</option>
                            <option value="Matrimonial">Matrimonial</option>
                            <option value="Panorámica">Panorámica</option>
                            <option value="Clásica">Clásica</option>
                            <option value="Estándar">Estándar</option>
                            <option value="Infinity Suite">Infinity Suite (Temática)</option>
                            <option value="Golden Suite">Golden Suite (Temática)</option>
                            <option value="Nova Suite">Nova Suite (Temática)</option>
                            <option value="Play Station">Play Station Suite</option>
                            <option value="Cinema Suite">Cinema Suite</option>
                            <option value="Nintendo Suite">Nintendo Suite</option>
                            <option value="Black Suite">Black Suite</option>
                        </select>
                    </div>

                    <div class="form-inline">
                        <div class="form-group">
                            <label for="habPiso">Piso *</label>
                            <input type="number" id="habPiso" min="1" max="10" required>
                        </div>

                        <div class="form-group">
                            <label for="habEstado">Estado *</label>
                            <select id="habEstado" required>
                                <option value="DISPONIBLE">DISPONIBLE</option>
                                <option value="OCUPADA">OCUPADA</option>
                                <option value="LIMPIEZA">LIMPIEZA</option>
                                <option value="MANTENIMIENTO">MANTENIMIENTO</option>
                            </select>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primario" style="width: 100%; margin-top: 0.7rem;">
                        Guardar habitación
                    </button>

                    <p id="estado-hab-admin" class="estado-reserva"></p>
                </form>
            </div>

            <!-- Tabla -->
            <div class="card">
                <h3>Listado de habitaciones</h3>
                <p style="font-size:0.85rem; color:#555; margin-bottom:0.7rem;">
                    Esta tabla representa las habitaciones almacenadas en el sistema.
                    En un proyecto real, esta información se obtendría de la base de datos
                    <code>hotel_casanova</code> (tabla <code>habitaciones</code>).
                </p>

                <div style="overflow-x:auto;">
                    <table style="width:100%; border-collapse: collapse; font-size:0.85rem;">
                        <thead>
                            <tr style="background:#f0f0f0;">
                                <th style="text-align:left; padding:0.4rem;">N° Habitación</th>
                                <th style="text-align:left; padding:0.4rem;">Tipo</th>
                                <th style="text-align:left; padding:0.4rem;">Piso</th>
                                <th style="text-align:left; padding:0.4rem;">Estado</th>
                                <th style="text-align:left; padding:0.4rem;">Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tabla-habs-admin">
                            <!-- Filas generadas por JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </section>

    <footer>
        © <span id="year"></span> Hotel Casanova – Proyecto Académico UTP
    </footer>

    <!-- JS global -->
    <script src="../js/app.js"></script>

    <!-- Script específico de esta página -->
    <script>
        const STORAGE_HABS = "habitaciones_casanova_admin";

        // Datos iniciales (como si vinieran de la BD)
        const habitacionesBase = [
            { numero: "J101", tipo: "Junior Suite", piso: 1, estado: "DISPONIBLE" },
            { numero: "J102", tipo: "Junior Suite", piso: 1, estado: "DISPONIBLE" },
            { numero: "E201", tipo: "Ejecutiva", piso: 2, estado: "DISPONIBLE" },
            { numero: "M301", tipo: "Matrimonial", piso: 3, estado: "DISPONIBLE" },
            { numero: "P401", tipo: "Panorámica", piso: 4, estado: "DISPONIBLE" },
            { numero: "C501", tipo: "Clásica", piso: 5, estado: "DISPONIBLE" },
            { numero: "ST601", tipo: "Estándar", piso: 6, estado: "DISPONIBLE" },
            { numero: "INF1", tipo: "Infinity Suite", piso: 2, estado: "DISPONIBLE" },
            { numero: "GOLD1", tipo: "Golden Suite", piso: 2, estado: "DISPONIBLE" }
        ];

        function leerHabitaciones() {
            try {
                const raw = localStorage.getItem(STORAGE_HABS);
                if (!raw) return [...habitationsInit];
                const arr = JSON.parse(raw);
                return Array.isArray(arr) ? arr : [...habitationsInit];
            } catch (e) {
                return [...habitationsInit];
            }
        }

        // Copia fija para cuando no hay nada en storage
        const habitationsInit = [...habitacionesBase];

        let habitaciones = leerHabitaciones();

        function guardarHabitaciones() {
            localStorage.setItem(STORAGE_HABS, JSON.stringify(habitaciones));
        }

        function renderTabla() {
            const tbody = document.getElementById("tabla-habs-admin");
            tbody.innerHTML = "";

            habitaciones.forEach((h, index) => {
                const tr = document.createElement("tr");

                let colorEstado = "#1d8d42"; // DISPONIBLE
                if (h.estado === "OCUPADA") colorEstado = "#c62828";
                if (h.estado === "LIMPIEZA" || h.estado === "MANTENIMIENTO") colorEstado = "#f4b41a";

                tr.innerHTML = `
                <td style="padding:0.4rem; border-bottom:1px solid #eee;">${h.numero}</td>
                <td style="padding:0.4rem; border-bottom:1px solid #eee;">${h.tipo}</td>
                <td style="padding:0.4rem; border-bottom:1px solid #eee;">${h.piso}</td>
                <td style="padding:0.4rem; border-bottom:1px solid #eee;">
                    <span style="font-weight:600; color:${colorEstado};">${h.estado}</span>
                </td>
                <td style="padding:0.4rem; border-bottom:1px solid #eee;">
                    <button data-index="${index}" data-accion="disp" class="btn btn-primario" style="font-size:0.75rem; padding:0.2rem 0.6rem;">Disponible</button>
                    <button data-index="${index}" data-accion="limp" class="btn btn-secundario" style="font-size:0.75rem; padding:0.2rem 0.6rem; margin-left:0.2rem;">Limpieza</button>
                    <button data-index="${index}" data-accion="elim" class="btn btn-secundario" style="font-size:0.75rem; padding:0.2rem 0.6rem; margin-left:0.2rem;">Eliminar</button>
                </td>
            `;

                tbody.appendChild(tr);
            });
        }

        function mostrarMensaje(texto, ok = true) {
            const p = document.getElementById("estado-hab-admin");
            p.textContent = texto;
            p.classList.remove("estado-ok", "estado-error");
            p.classList.add(ok ? "estado-ok" : "estado-error");
        }

        document.getElementById("form-habitacion-admin").addEventListener("submit", function (e) {
            e.preventDefault();

            const numero = document.getElementById("habNumero").value.trim();
            const tipo = document.getElementById("habTipo").value;
            const piso = parseInt(document.getElementById("habPiso").value, 10);
            const estado = document.getElementById("habEstado").value;

            if (!numero || !tipo || !piso || !estado) {
                mostrarMensaje("Completa todos los campos obligatorios.", false);
                return;
            }

            // Si ya existe, actualizamos; si no, agregamos
            const idx = habitaciones.findIndex(h => h.numero.toUpperCase() === numero.toUpperCase());
            const habData = { numero, tipo, piso, estado };

            if (idx >= 0) {
                habitaciones[idx] = habData;
                mostrarMensaje("Habitación actualizada correctamente.");
            } else {
                habitaciones.push(habData);
                mostrarMensaje("Habitación registrada correctamente.");
            }

            guardarHabitaciones();
            renderTabla();
            this.reset();
        });

        // Delegación de eventos para botones de la tabla
        document.getElementById("tabla-habs-admin").addEventListener("click", function (e) {
            const btn = e.target.closest("button");
            if (!btn) return;

            const index = parseInt(btn.getAttribute("data-index"), 10);
            const accion = btn.getAttribute("data-accion");
            if (isNaN(index) || !habitaciones[index]) return;

            if (accion === "disp") {
                habitaciones[index].estado = "DISPONIBLE";
                mostrarMensaje("Habitación marcada como DISPONIBLE.");
            } else if (accion === "limp") {
                habitaciones[index].estado = "LIMPIEZA";
                mostrarMensaje("Habitación marcada en LIMPIEZA.");
            } else if (accion === "elim") {
                habitaciones.splice(index, 1);
                mostrarMensaje("Habitación eliminada del sistema.");
            }

            guardarHabitaciones();
            renderTabla();
        });

        // Inicializar
        renderTabla();
    </script>

</body>

</html>