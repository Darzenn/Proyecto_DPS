<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Usuarios – Administrador</title>

    <link rel="stylesheet" href="../css/styles.css">
</head>

<body>

    <header>
        <div class="nav-container">
            <div class="logo">
                <span>CASANOVA</span> HOTEL
            </div>

            <nav>
                <ul>
                    <li><a href="../index.html">Inicio</a></li>
                    <li><a href="panel.html">Panel admin</a></li>
                    <li><a href="login.html">Cerrar sesión</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <section class="section">
        <h1 class="section-titulo">Gestión de Usuarios Internos</h1>
        <p class="section-subtitulo">
            Módulo para administrar los usuarios del sistema: administradores y recepcionistas.
            Este módulo está vinculado conceptualmente a la tabla <code>usuarios</code> de la base de datos.
        </p>
    </section>

    <section class="section">
        <div class="reserva-layout">

            <!-- FORMULARIO -->
            <div class="card">
                <h3>Registrar / Actualizar usuario</h3>

                <form id="form-usuario-admin">
                    <div class="form-group">
                        <label for="usuNombre">Nombre completo *</label>
                        <input type="text" id="usuNombre" required placeholder="Ejemplo: Juan Pérez">
                    </div>

                    <div class="form-group">
                        <label for="usuCorreo">Correo institucional *</label>
                        <input type="email" id="usuCorreo" required placeholder="usuario@casanova.pe">
                    </div>

                    <div class="form-group">
                        <label for="usuClave">Contraseña *</label>
                        <input type="password" id="usuClave" required>
                    </div>

                    <div class="form-group">
                        <label for="usuRol">Rol del sistema *</label>
                        <select id="usuRol" required>
                            <option value="">Seleccionar rol</option>
                            <option value="ADMIN">Administrador</option>
                            <option value="RECEPCIONISTA">Recepcionista</option>
                        </select>
                    </div>

                    <button type="submit" id="btn-usuario-guardar" class="btn btn-primario"
                        style="width: 100%; margin-top: 0.6rem;">
                        Guardar usuario
                    </button>

                    <p id="estado-usuario-admin" class="estado-reserva"></p>
                </form>
            </div>

            <!-- TABLA -->
            <div class="card">
                <h3>Usuarios registrados</h3>
                <p style="font-size:0.85rem; color:#555; margin-bottom:0.7rem;">
                    Representación de la tabla <code>usuarios</code> del sistema:
                    <code>(id_usuario, nombre, correo, rol, contraseña)</code>.
                </p>

                <div style="overflow-x:auto;">
                    <table style="width:100%; border-collapse:collapse; font-size:0.85rem;">
                        <thead>
                            <tr style="background:#f0f0f0;">
                                <th style="padding:0.4rem;">Nombre</th>
                                <th style="padding:0.4rem;">Correo</th>
                                <th style="padding:0.4rem;">Rol</th>
                                <th style="padding:0.4rem;">Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tabla-usuarios-admin">
                            <!-- Llenado con JS -->
                        </tbody>
                    </table>
                </div>
            </div>

        </div>
    </section>

    <footer>
        © <span id="year"></span> Hotel Casanova – Proyecto Académico UTP
    </footer>

    <script src="../js/app.js"></script>

    <!-- SCRIPT ESPECÍFICO -->
    <script>
        const STORAGE_USUARIOS = "usuarios_casanova_admin";

        // Usuarios base (como si vinieran de la BD)
        const usuariosDefault = [
            {
                nombre: "Administrador General",
                correo: "admin@casanova.pe",
                clave: "admin123",
                rol: "ADMIN"
            },
            {
                nombre: "Recepcionista 1",
                correo: "recepcion1@casanova.pe",
                clave: "123456",
                rol: "RECEPCIONISTA"
            }
        ];

        function leerUsuarios() {
            try {
                const raw = localStorage.getItem(STORAGE_USUARIOS);
                if (!raw) return [...usuariosDefault];
                const arr = JSON.parse(raw);
                return Array.isArray(arr) ? arr : [...usuariosDefault];
            } catch {
                return [...usuariosDefault];
            }
        }

        let usuarios = leerUsuarios();
        let indiceEditando = null;

        function guardarUsuarios() {
            localStorage.setItem(STORAGE_USUARIOS, JSON.stringify(usuarios));
        }

        function mostrarMensajeU(texto, ok = true) {
            const p = document.getElementById("estado-usuario-admin");
            p.textContent = texto;
            p.classList.remove("estado-ok", "estado-error");
            p.classList.add(ok ? "estado-ok" : "estado-error");
        }

        function renderUsuariosTabla() {
            const tbody = document.getElementById("tabla-usuarios-admin");
            tbody.innerHTML = "";

            usuarios.forEach((u, index) => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                <td style="padding:0.4rem; border-bottom:1px solid #eee;">${u.nombre}</td>
                <td style="padding:0.4rem; border-bottom:1px solid #eee;">${u.correo}</td>
                <td style="padding:0.4rem; border-bottom:1px solid #eee;">${u.rol}</td>
                <td style="padding:0.4rem; border-bottom:1px solid #eee;">
                    <button data-index="${index}" data-accion="edit" class="btn btn-primario" style="font-size:0.75rem; padding:0.2rem 0.6rem;">Editar</button>
                    <button data-index="${index}" data-accion="elim" class="btn btn-secundario" style="font-size:0.75rem; padding:0.2rem 0.6rem; margin-left:0.2rem;">Eliminar</button>
                </td>
            `;
                tbody.appendChild(tr);
            });
        }

        // Registrar usuario
        document.getElementById("form-usuario-admin").addEventListener("submit", function (e) {
            e.preventDefault();

            const nombre = document.getElementById("usuNombre").value.trim();
            const correo = document.getElementById("usuCorreo").value.trim();
            const clave = document.getElementById("usuClave").value.trim();
            const rol = document.getElementById("usuRol").value;

            if (!nombre || !correo || !clave || !rol) {
                mostrarMensajeU("Completa todos los campos correctamente.", false);
                return;
            }

            const data = { nombre, correo, clave, rol };

            if (indiceEditando !== null) {
                usuarios[indiceEditando] = data;
                mostrarMensajeU("Usuario actualizado correctamente.");
            } else {
                const existe = usuarios.some(u => u.correo === correo);
                if (existe) {
                    mostrarMensajeU("Ya existe un usuario con ese correo.", false);
                    return;
                }

                usuarios.push(data);
                mostrarMensajeU("Usuario registrado correctamente.");
            }

            guardarUsuarios();
            renderUsuariosTabla();
            this.reset();

            indiceEditando = null;
            document.getElementById("btn-usuario-guardar").textContent = "Guardar usuario";
        });

        // Acciones en la tabla
        document.getElementById("tabla-usuarios-admin").addEventListener("click", function (e) {
            const btn = e.target.closest("button");
            if (!btn) return;

            const index = parseInt(btn.getAttribute("data-index"), 10);
            const accion = btn.getAttribute("data-accion");

            if (accion === "edit") {
                const u = usuarios[index];

                document.getElementById("usuNombre").value = u.nombre;
                document.getElementById("usuCorreo").value = u.correo;
                document.getElementById("usuClave").value = u.clave;
                document.getElementById("usuRol").value = u.rol;

                indiceEditando = index;

                mostrarMensajeU("Editando usuario seleccionado. Modifica y guarda para actualizar.");
                document.getElementById("btn-usuario-guardar").textContent = "Actualizar usuario";

            } else if (accion === "elim") {
                usuarios.splice(index, 1);
                guardarUsuarios();
                renderUsuariosTabla();
                mostrarMensajeU("Usuario eliminado correctamente.");
            }
        });

        // Inicializar tabla
        renderUsuariosTabla();
    </script>

</body>

</html>