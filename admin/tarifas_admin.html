<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Tarifas – Administrador</title>

    <link rel="stylesheet" href="../css/styles.css">
</head>

<body>

    <header>
        <div class="nav-container">
            <div class="logo">
                <span>CASANOVA</span> HOTEL
            </div>

            <nav>
                <ul>
                    <li><a href="../index.html">Inicio</a></li>
                    <li><a href="panel.html">Panel admin</a></li>
                    <li><a href="login.html">Cerrar sesión</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <section class="section">
        <h1 class="section-titulo">Gestión de Tarifas por Horas</h1>
        <p class="section-subtitulo">
            Módulo interno para administrar las tarifas por horas según el tipo de habitación y el rango de días.
            Se relaciona directamente con la tabla <code>tarifas_horas</code> de la base de datos
            <code>hotel_casanova</code>.
        </p>
    </section>

    <section class="section">
        <div class="reserva-layout">
            <!-- Formulario -->
            <div class="card">
                <h3>Registrar / Actualizar tarifa</h3>

                <form id="form-tarifa-admin">
                    <div class="form-group">
                        <label for="tarTipo">Tipo de habitación *</label>
                        <select id="tarTipo" required>
                            <option value="">Selecciona una opción</option>
                            <option value="Junior Suite">Junior Suite</option>
                            <option value="Ejecutiva">Ejecutiva</option>
                            <option value="Matrimonial">Matrimonial</option>
                            <option value="Panorámica">Panorámica</option>
                            <option value="Clásica">Clásica</option>
                            <option value="Estándar">Estándar</option>
                            <option value="Infinity Suite">Infinity Suite (Temática)</option>
                            <option value="Golden Suite">Golden Suite (Temática)</option>
                            <option value="Nova Suite">Nova Suite (Temática)</option>
                            <option value="Play Station">Play Station Suite</option>
                            <option value="Cinema Suite">Cinema Suite</option>
                            <option value="Nintendo Suite">Nintendo Suite</option>
                            <option value="Black Suite">Black Suite</option>
                        </select>
                    </div>

                    <div class="form-inline">
                        <div class="form-group">
                            <label for="tarRango">Rango de días *</label>
                            <select id="tarRango" required>
                                <option value="">Selecciona</option>
                                <option value="LJ">LJ (Lunes a Jueves)</option>
                                <option value="VD">VD (Viernes a Domingo)</option>
                                <option value="LV">LV (Lunes a Viernes – Temáticas)</option>
                            </select>
                            <small>En tu BD esto va en el campo <code>rango_dias</code>.</small>
                        </div>

                        <div class="form-group">
                            <label for="tarHoras">Cantidad de horas *</label>
                            <input type="number" id="tarHoras" min="1" max="24" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="tarPrecio">Precio (S/.) *</label>
                        <input type="number" step="0.01" id="tarPrecio" min="0" required>
                    </div>

                    <button type="submit" id="btn-tarifa-guardar" class="btn btn-primario"
                        style="width:100%; margin-top:0.7rem;">
                        Guardar tarifa
                    </button>

                    <p id="estado-tarifas-admin" class="estado-reserva"></p>
                </form>
            </div>

            <!-- Tabla de tarifas -->
            <div class="card">
                <h3>Tarifas configuradas</h3>
                <p style="font-size:0.85rem; color:#555; margin-bottom:0.7rem;">
                    Listado de las tarifas por horas del hotel. Cada fila representa un registro en la tabla
                    <code>tarifas_horas</code>:<br>
                    <code>(id_tarifa, id_tipo_habitacion, rango_dias, horas, precio)</code>.
                </p>

                <div style="overflow-x:auto; max-height:360px;">
                    <table style="width:100%; border-collapse:collapse; font-size:0.8rem;">
                        <thead>
                            <tr style="background:#f0f0f0;">
                                <th style="text-align:left; padding:0.4rem;">Tipo habitación</th>
                                <th style="text-align:left; padding:0.4rem;">Rango días</th>
                                <th style="text-align:left; padding:0.4rem;">Horas</th>
                                <th style="text-align:left; padding:0.4rem;">Precio</th>
                                <th style="text-align:left; padding:0.4rem;">Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tabla-tarifas-admin">
                            <!-- Filas generadas por JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>

    <footer>
        © <span id="year"></span> Hotel Casanova – Proyecto Académico UTP
    </footer>

    <script src="../js/app.js"></script>

    <!-- Script específico de tarifas -->
    <script>
        const STORAGE_TARIFAS = "tarifas_casanova_admin";

        // Tarifas iniciales (las mismas que usas en reservas.js)
        const tarifasDefault = [
            // Junior Suite
            { tipo: "Junior Suite", rango: "LJ", horas: 6, precio: 85 },
            { tipo: "Junior Suite", rango: "LJ", horas: 12, precio: 119 },
            { tipo: "Junior Suite", rango: "VD", horas: 5, precio: 90 },
            { tipo: "Junior Suite", rango: "VD", horas: 8, precio: 129 },

            // Ejecutiva
            { tipo: "Ejecutiva", rango: "LJ", horas: 6, precio: 60 },
            { tipo: "Ejecutiva", rango: "LJ", horas: 12, precio: 85 },
            { tipo: "Ejecutiva", rango: "VD", horas: 5, precio: 65 },
            { tipo: "Ejecutiva", rango: "VD", horas: 8, precio: 95 },

            // Matrimonial
            { tipo: "Matrimonial", rango: "LJ", horas: 6, precio: 50 },
            { tipo: "Matrimonial", rango: "LJ", horas: 12, precio: 75 },
            { tipo: "Matrimonial", rango: "VD", horas: 5, precio: 55 },
            { tipo: "Matrimonial", rango: "VD", horas: 8, precio: 85 },

            // Panorámica
            { tipo: "Panorámica", rango: "LJ", horas: 6, precio: 45 },
            { tipo: "Panorámica", rango: "LJ", horas: 12, precio: 65 },
            { tipo: "Panorámica", rango: "VD", horas: 5, precio: 50 },
            { tipo: "Panorámica", rango: "VD", horas: 8, precio: 80 },

            // Clásica
            { tipo: "Clásica", rango: "LJ", horas: 6, precio: 40 },
            { tipo: "Clásica", rango: "LJ", horas: 12, precio: 60 },
            { tipo: "Clásica", rango: "VD", horas: 5, precio: 45 },
            { tipo: "Clásica", rango: "VD", horas: 8, precio: 70 },

            // Estándar
            { tipo: "Estándar", rango: "LJ", horas: 6, precio: 35 },
            { tipo: "Estándar", rango: "LJ", horas: 12, precio: 55 },
            { tipo: "Estándar", rango: "VD", horas: 5, precio: 40 },
            { tipo: "Estándar", rango: "VD", horas: 8, precio: 65 },

            // Temáticas (LV)
            { tipo: "Infinity Suite", rango: "LV", horas: 5, precio: 160 },
            { tipo: "Infinity Suite", rango: "LV", horas: 8, precio: 199 },

            { tipo: "Golden Suite", rango: "LV", horas: 5, precio: 140 },
            { tipo: "Golden Suite", rango: "LV", horas: 8, precio: 209 },

            { tipo: "Nova Suite", rango: "LV", horas: 5, precio: 130 },
            { tipo: "Nova Suite", rango: "LV", horas: 8, precio: 199 },

            { tipo: "Play Station", rango: "LV", horas: 5, precio: 130 },
            { tipo: "Play Station", rango: "LV", horas: 8, precio: 199 },

            { tipo: "Cinema Suite", rango: "LV", horas: 5, precio: 125 },

            { tipo: "Nintendo Suite", rango: "LV", horas: 5, precio: 110 },

            { tipo: "Black Suite", rango: "LV", horas: 5, precio: 85 }
        ];

        function leerTarifas() {
            try {
                const raw = localStorage.getItem(STORAGE_TARIFAS);
                if (!raw) return [...tarifasDefault];
                const arr = JSON.parse(raw);
                return Array.isArray(arr) ? arr : [...tarifasDefault];
            } catch (e) {
                return [...tarifasDefault];
            }
        }

        let tarifas = leerTarifas();
        let indiceEditando = null;

        function guardarTarifas() {
            localStorage.setItem(STORAGE_TARIFAS, JSON.stringify(tarifas));
        }

        function mostrarMensajeTar(mensaje, ok = true) {
            const p = document.getElementById("estado-tarifas-admin");
            p.textContent = mensaje;
            p.classList.remove("estado-ok", "estado-error");
            p.classList.add(ok ? "estado-ok" : "estado-error");
        }

        function renderTarifasTabla() {
            const tbody = document.getElementById("tabla-tarifas-admin");
            tbody.innerHTML = "";

            tarifas.forEach((t, index) => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                <td style="padding:0.4rem; border-bottom:1px solid #eee;">${t.tipo}</td>
                <td style="padding:0.4rem; border-bottom:1px solid #eee;">${t.rango}</td>
                <td style="padding:0.4rem; border-bottom:1px solid #eee;">${t.horas} H</td>
                <td style="padding:0.4rem; border-bottom:1px solid #eee;">S/ ${t.precio.toFixed(2)}</td>
                <td style="padding:0.4rem; border-bottom:1px solid #eee;">
                    <button data-index="${index}" data-accion="edit"
                            class="btn btn-primario"
                            style="font-size:0.75rem; padding:0.2rem 0.6rem;">
                        Editar
                    </button>
                    <button data-index="${index}" data-accion="elim"
                            class="btn btn-secundario"
                            style="font-size:0.75rem; padding:0.2rem 0.6rem; margin-left:0.2rem;">
                        Eliminar
                    </button>
                </td>
            `;
                tbody.appendChild(tr);
            });
        }

        // Manejo de formulario
        document.getElementById("form-tarifa-admin").addEventListener("submit", function (e) {
            e.preventDefault();

            const tipo = document.getElementById("tarTipo").value;
            const rango = document.getElementById("tarRango").value;
            const horas = parseInt(document.getElementById("tarHoras").value, 10);
            const precio = parseFloat(document.getElementById("tarPrecio").value);

            if (!tipo || !rango || !horas || isNaN(precio)) {
                mostrarMensajeTar("Completa todos los campos correctamente.", false);
                return;
            }

            const nuevaTarifa = { tipo, rango, horas, precio };

            if (indiceEditando !== null) {
                // actualizamos
                tarifas[indiceEditando] = nuevaTarifa;
                mostrarMensajeTar("Tarifa actualizada correctamente.");
            } else {
                // validamos que no exista ya el mismo registro
                const existe = tarifas.some(t =>
                    t.tipo === tipo && t.rango === rango && t.horas === horas
                );
                if (existe) {
                    mostrarMensajeTar("Ya existe una tarifa para ese tipo, rango y cantidad de horas.", false);
                    return;
                }

                tarifas.push(nuevaTarifa);
                mostrarMensajeTar("Tarifa registrada correctamente.");
            }

            guardarTarifas();
            renderTarifasTabla();
            this.reset();
            indiceEditando = null;
            document.getElementById("btn-tarifa-guardar").textContent = "Guardar tarifa";
        });

        // Acciones de la tabla (Editar / Eliminar)
        document.getElementById("tabla-tarifas-admin").addEventListener("click", function (e) {
            const btn = e.target.closest("button");
            if (!btn) return;

            const index = parseInt(btn.getAttribute("data-index"), 10);
            const accion = btn.getAttribute("data-accion");
            if (isNaN(index) || !tarifas[index]) return;

            if (accion === "edit") {
                const t = tarifas[index];
                document.getElementById("tarTipo").value = t.tipo;
                document.getElementById("tarRango").value = t.rango;
                document.getElementById("tarHoras").value = t.horas;
                document.getElementById("tarPrecio").value = t.precio;

                indiceEditando = index;
                document.getElementById("btn-tarifa-guardar").textContent = "Actualizar tarifa";
                mostrarMensajeTar("Editando tarifa seleccionada. Modifica y guarda para actualizar.", true);
            } else if (accion === "elim") {
                tarifas.splice(index, 1);
                guardarTarifas();
                renderTarifasTabla();
                mostrarMensajeTar("Tarifa eliminada correctamente.");
            }
        });

        // Inicializar tabla al cargar
        renderTarifasTabla();
    </script>

</body>

</html>